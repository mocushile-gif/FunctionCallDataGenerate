# Function Call Data Generation Framework
ä¸€ä¸ªå¼ºå¤§çš„Agentå·¥å…·è°ƒç”¨æ•°æ®ç”Ÿæˆæ¡†æ¶ï¼Œä¸“é—¨ç”¨äºç”Ÿæˆé«˜è´¨é‡çš„å¤šè½®Agentè§„åˆ’ä¸å·¥å…·ä½¿ç”¨å¯¹è¯æ•°æ®ï¼Œæœ‰æ•ˆæå‡å¤§è¯­è¨€æ¨¡å‹çš„Agentè§„åˆ’å’Œå·¥å…·è°ƒç”¨èƒ½åŠ›ã€‚åŸºäºæˆ‘ä»¬ç”Ÿæˆçš„8ké«˜è´¨é‡æ•°æ®ï¼Œé€šè¿‡LoRAå¾®è°ƒç»“åˆToolRLå¼ºåŒ–å­¦ä¹ è®­ç»ƒqwen-32b-instructæ¨¡å‹åï¼Œåœ¨BFCLæ¦œå•çš„multi-turnæŒ‡æ ‡ä¸Šå®ç°äº†ä»22.25%åˆ°45.88%çš„æ˜¾è‘—æå‡ï¼Œæ€§èƒ½æå‡å¹…åº¦è¾¾åˆ°**105.8%**ã€‚åœ¨åŒç­‰æ•°æ®è§„æ¨¡ä¸‹ï¼Œæˆ‘ä»¬çš„æ•°æ®ä¸ºæ¨¡å‹å¸¦æ¥çš„ç²¾åº¦æå‡æ˜¾è‘—è¶…è¶Šå½“å‰æ‰€æœ‰ä¸»æµAgentå¼€æºæ•°æ®é›†ï¼ˆåŒ…æ‹¬ToolACEã€xLAMã€ToolBenchç­‰ï¼‰ï¼Œå±•ç°äº†å“è¶Šçš„æ•°æ®è´¨é‡å’Œè®­ç»ƒæ•ˆæœã€‚
<div align="center">
  <img src="https://gitlab.bj.sensetime.com/lm-toolchain/function_call_data/-/raw/guodongyu/data_generate/pipeline.png" width="100%" height="100%">
</div>

<br>

## ğŸš€ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ª**é«˜è´¨é‡å¤šè½®å·¥å…·è°ƒç”¨æ•°æ®ç”Ÿæˆpipeline**ï¼Œä¸“é—¨é’ˆå¯¹BFCLæ¦œå•ä¸Šçš„multiturnæŒ‡æ ‡è¿›è¡Œä¼˜åŒ–ã€‚é€šè¿‡å¤šæ™ºèƒ½ä½“åä½œçš„æ–¹å¼ï¼Œè‡ªåŠ¨ç”ŸæˆåŒ…å«å·¥å…·ä½¿ç”¨ã€æ–‡ä»¶ç³»ç»Ÿæ“ä½œã€æ•°æ®åº“æŸ¥è¯¢ç­‰å¤æ‚åœºæ™¯çš„å¯¹è¯æ•°æ®ã€‚

### ğŸ¯ é¡¹ç›®èƒŒæ™¯
ç›®å‰å¼€æºç ”ç©¶ä¸­åªå…¬å¼€æ¨¡å‹å’Œéƒ¨åˆ†æ•°æ®ï¼Œæ— æ³•é€šè¿‡å¼€æºæ•°æ®å¤§å¹…æé«˜æ¨¡å‹agentèƒ½åŠ›ã€‚ç°æœ‰å¼€æºå¤šè½®æ•°æ®å¾ˆå°‘ï¼Œå³ä¾¿æœ‰ä¹Ÿæ˜¯å°‘é‡ã€å¤šæ ·æ€§ä¸è¶³ã€æ— æ³•æ ¹æ®ä¸šåŠ¡é’ˆå¯¹æ€§æ‹“å±•ã€‚

### ğŸ¯ é¡¹ç›®ç›®æ ‡
å¼€å‘ä¸€ä¸ªé«˜è´¨é‡æ•°æ®ç”Ÿæˆpipelineï¼Œæ”¯æŒç”Ÿæˆ**é«˜è´¨é‡ã€å¤šæ ·ã€å¯ä»»æ„å®šåˆ¶æ‹“å±•çš„å¤šè½®å·¥å…·è°ƒç”¨æ•°æ®**ï¼Œä¸»è¦é’ˆå¯¹BFCLæ¦œå•ä¸Šçš„multiturnæŒ‡æ ‡è¿›è¡Œä¼˜åŒ–ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ† Pipelineç‰¹ç‚¹
- **ğŸ¯ é«˜è´¨é‡**: åœ¨æ•°æ®ç”Ÿæˆå‰ã€ä¸­ã€åé‡‡ç”¨å„ç§æé«˜æ•°æ®è´¨é‡çš„æ–¹æ³•
- **ğŸ”§ å¯æ‹“å±•**: å¯ä»¥ä»»æ„æ·»åŠ å·¥å…·å’Œæ–‡ä»¶æ¥ç”Ÿäº§è‡ªå®šä¹‰çš„agentæ•°æ®
- **ğŸŒ åŸºäºçœŸå®å¯æ‰§è¡Œç¯å¢ƒ**: åŒ…å«300ä¸ªå¯æ‰§è¡Œå·¥å…· + 3400ä¸ªRapidAPIå·¥å…·
- **ğŸ“ ç¯å¢ƒå¯äº’åŠ¨æ€§**: åŒ…å«80+ä¸ªä¸åŒæ ¼å¼æ–‡ä»¶ä½œä¸ºbaseç¯å¢ƒ
- **ğŸ”„ å·¥å…·è°ƒç”¨æ¨¡å¼å¤šæ ·æ€§**: æ”¯æŒsingleã€parallelã€multipleã€dependentã€no-tool-useã€miss-paramç­‰æ¨¡å¼
- **ğŸ“Š å¤šè½®é•¿ä¸Šä¸‹æ–‡**: ç›®æ ‡ç”Ÿæˆçš„æ•°æ®è½®æ•°å¯ä»»æ„è°ƒæ•´æ¯”ä¾‹

### ğŸ¤– å¤šæ™ºèƒ½ä½“æ¶æ„
- **UserAgent**: åŸºäºæ–‡ä»¶ä¿¡æ¯ã€å·¥å…·ã€è°ƒç”¨æ¨¡å¼ã€è¯­æ°”é£æ ¼ç”Ÿæˆè´´è¿‘çœŸå®ç”¨æˆ·çš„ä»»åŠ¡æŒ‡ä»¤
- **AssistantAgent**: æ ¹æ®ä¸Šä¸‹æ–‡å’Œç°æœ‰å·¥å…·è¿›è¡Œå›å¤ï¼Œæ”¯æŒä¼—æŠ•æ¨¡å¼
- **ToolAgent**: åœ¨æ²™ç›’ç¯å¢ƒä¸­æ‰§è¡Œå·¥å…·ï¼Œæ”¯æŒè™šæ‹Ÿå›å¤æœºåˆ¶
- **CheckerAgent**: å¤šå±‚æ¬¡æ£€æŸ¥æœºåˆ¶ï¼Œç¡®ä¿æ•°æ®è´¨é‡

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UserAgent     â”‚    â”‚ AssistantAgent  â”‚    â”‚   ToolAgent     â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ é—®é¢˜ç”Ÿæˆ      â”‚â—„â”€â”€â–ºâ”‚ â€¢ å·¥å…·è°ƒç”¨      â”‚â—„â”€â”€â–ºâ”‚ â€¢ å·¥å…·æ‰§è¡Œ      â”‚
â”‚ â€¢ ä»»åŠ¡æ¾„æ¸…      â”‚    â”‚ â€¢ å“åº”ç”Ÿæˆ      â”‚    â”‚ â€¢ ç¯å¢ƒç®¡ç†      â”‚
â”‚ â€¢ äººæ ¼æ¨¡æ‹Ÿ      â”‚    â”‚ â€¢ ä¼—æŠ•æœºåˆ¶      â”‚    â”‚ â€¢ ä»£ç è§£é‡Šå™¨    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CheckerAgent   â”‚    â”‚   Pipeline      â”‚    â”‚   Tools         â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ è´¨é‡æ£€æŸ¥      â”‚    â”‚ â€¢ æµç¨‹æ§åˆ¶      â”‚    â”‚ â€¢ æ–‡ä»¶ç³»ç»Ÿ      â”‚
â”‚ â€¢ é”™è¯¯ä¿®æ­£      â”‚    â”‚ â€¢ çŠ¶æ€ç®¡ç†      â”‚    â”‚ â€¢ æ•°æ®åº“       â”‚
â”‚ â€¢ é‡è¯•æœºåˆ¶      â”‚    â”‚ â€¢ æ•°æ®ä¿å­˜      â”‚    â”‚ â€¢ APIè°ƒç”¨       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
function_call_data/
â”œâ”€â”€ data_generate/
â”‚   â”œâ”€â”€ agent/                    # æ™ºèƒ½ä½“æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ user_agent.py        # ç”¨æˆ·æ™ºèƒ½ä½“
â”‚   â”‚   â”œâ”€â”€ assistant_agent.py   # åŠ©æ‰‹æ™ºèƒ½ä½“
â”‚   â”‚   â”œâ”€â”€ tool_agent.py        # å·¥å…·æ™ºèƒ½ä½“
â”‚   â”‚   â”œâ”€â”€ checker_agent.py     # æ£€æŸ¥æ™ºèƒ½ä½“
â”‚   â”‚   â”œâ”€â”€ model/               # LLMæ¨¡å‹æ¥å£
â”‚   â”‚   â””â”€â”€ rapidapi.py          # RapidAPIé›†æˆ
â”‚   â”œâ”€â”€ prompt                    # æç¤ºè¯æ¨¡æ¿
â”‚   â”œâ”€â”€ scripts                    # æ•°æ®ç”Ÿäº§è„šæœ¬
â”‚   â”œâ”€â”€ tools/                    # å·¥å…·ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ executable_functions/ # å¯æ‰§è¡Œå·¥å…·
â”‚   â”‚   â””â”€â”€ defines/             # å·¥å…·å®šä¹‰
â”‚   â”œâ”€â”€ utils                    # å·¥å…·å‡½æ•°é›†åˆ
â”‚   â”œâ”€â”€ working_dir/             # æ–‡ä»¶ç³»ç»Ÿï¼ˆæ™ºèƒ½ä½“äº¤äº’çš„ç¯å¢ƒï¼‰
â”‚   â”œâ”€â”€ .env                    # ç¯å¢ƒå˜é‡è®¾ç½®
â”‚   â””â”€â”€ pipeline.py              # ä¸»æµç¨‹æ§åˆ¶
```

## ğŸ¯ ä¸»è¦åŠŸèƒ½

### 1. æ™ºèƒ½ä½“ç³»ç»Ÿ

#### UserAgent (ç”¨æˆ·æ™ºèƒ½ä½“)
- **é—®é¢˜ç”Ÿæˆ**: åŸºäºç»™å®šæ–‡ä»¶ä¿¡æ¯ï¼ˆnä¸ªæ–‡ä»¶çš„å‰10è¡Œå†…å®¹å’ŒåŸºæœ¬ä¿¡æ¯ï¼‰ã€ç»™å®šå·¥å…·ã€ç»™å®šè°ƒç”¨æ¨¡å¼ã€ç»™å®šè¯­æ°”é£æ ¼ç”Ÿæˆè´´è¿‘çœŸå®ç”¨æˆ·çš„ä»»åŠ¡æŒ‡ä»¤
- **ä»»åŠ¡æ¾„æ¸…**: æ¯æ¬¡assistantç»™å‡ºæ€»ç»“å›å¤æ—¶åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œè‹¥æ— æ³•å®Œæˆåˆ™è®°å½•ä¸º-1ï¼Œè‹¥å®Œæˆåˆ™è¿›å…¥ä¸‹ä¸€ä¸ªturn
- **ç¯å¢ƒè¡¥å……**: è‹¥ä»»åŠ¡éœ€è¦è¡¥å……ä¿¡æ¯æ—¶ï¼ŒåŸºäºç¯å¢ƒç»™å‡ºçœŸå®è¡¥å……ä¿¡æ¯ï¼Œé¿å…è™šæ„ä¿¡æ¯
- **äººæ ¼æ¨¡æ‹Ÿ**: ä»persona_hubé‡‡æ ·äººæ ¼ç±»å‹ï¼Œæ”¯æŒä¸åŒè¯­æ°”é£æ ¼

#### AssistantAgent (åŠ©æ‰‹æ™ºèƒ½ä½“)
- **å·¥å…·è°ƒç”¨**: æ ¹æ®ä¸Šä¸‹æ–‡å’Œç°æœ‰å·¥å…·è¿›è¡Œå›å¤ï¼Œæ— æ³•çœ‹åˆ°ç¯å¢ƒå’Œæ–‡ä»¶å†…å®¹ï¼Œéœ€è¦ä½¿ç”¨ç‰¹å®šå·¥å…·æ¥è®¿é—®ç¯å¢ƒ
- **ä¼—æŠ•æ¨¡å¼**: æ¯æ¬¡ç”Ÿæˆnä¸ªå›å¤ï¼Œé€‰æ‹©æœ€å¤šçš„å›å¤ï¼ˆå¦‚3æ¬¡é‡Œ2æ¬¡éƒ½é€‰æ‹©äº†åŒä¸€ä¸ªå·¥å…·ï¼‰
- **å¤šæ¨¡å‹æ”¯æŒ**: æ”¯æŒGPTã€Qwenã€DeepSeekã€è±†åŒ…ç­‰å¤šç§LLMæ¨¡å‹
- **æ¨ç†èƒ½åŠ›**: æ”¯æŒæ¨ç†æ¨¡å‹çš„æ€ç»´é“¾è¾“å‡º

#### ToolAgent (å·¥å…·æ™ºèƒ½ä½“)
- **æ²™ç›’ç¯å¢ƒ**: æ¯æ¡æ•°æ®éƒ½å»ºç«‹å¯¹åº”çš„æ²™ç›’ç¯å¢ƒç”¨äºå‚¨å­˜å¯¹åº”æ–‡ä»¶èµ„æ–™
- **å·¥å…·æ‰§è¡Œ**: å®‰å…¨æ‰§è¡Œ300ä¸ªå¯æ‰§è¡Œå·¥å…·ï¼ˆPythonå‡½æ•°ã€æ–‡ä»¶æ“ä½œã€æ•°æ®åº“ã€ç»Ÿè®¡åˆ†æã€å¯è§†åŒ–ã€æ“ä½œç³»ç»Ÿã€å›¾åƒå¤„ç†ã€å¤–éƒ¨APIç­‰ï¼‰
- **RapidAPIé›†æˆ**: æ”¯æŒ3400ä¸ªRapidAPIå·¥å…·ï¼Œè‹¥æ‰§è¡Œå¤±è´¥åˆ™åˆ‡æ¢è™šæ‹Ÿå›å¤
- **è¾“å‡ºæ§åˆ¶**: è¶…è¿‡ç‰¹å®šé•¿åº¦çš„å›å¤è¿›è¡Œæˆªæ–­
- **è™šæ‹Ÿå›å¤**: å¯¹äºRapidAPIå·¥å…·ï¼Œè‹¥çœŸå®å›å¤å‡ºé”™ï¼Œåˆ™åŸºäºå†å²å›å¤cacheä½¿ç”¨æ¨¡å‹è¿›è¡Œè™šæ‹Ÿå›å¤

#### CheckerAgent (æ£€æŸ¥æ™ºèƒ½ä½“)
- **å¤šå±‚æ¬¡æ£€æŸ¥**: æ¯æ¬¡assistant agentå›å¤æ—¶éƒ½ç»™å‡ºåé¦ˆ
- **Rule Checker**: æ£€æŸ¥å·¥å…·æ˜¯å¦å­˜åœ¨ã€å‚æ•°æ˜¯å¦å­˜åœ¨ã€å‚æ•°æ•°æ®ç±»å‹æ˜¯å¦ç¬¦åˆã€å¿…éœ€çš„å‚æ•°æ˜¯å¦éƒ½æœ‰
- **LLM Checker**: å¯¹äºæ²¡æœ‰è°ƒç”¨å·¥å…·çš„å›å¤è¿›è¡Œæ£€æŸ¥
- **Tool Call Checker**: å¯¹äºè°ƒç”¨äº†å·¥å…·çš„å›å¤è¿›è¡Œæ£€æŸ¥
- **é‡è¯•æœºåˆ¶**: æœ€å¤šåé¦ˆnæ¬¡ï¼Œè‹¥næ¬¡éƒ½æ²¡æœ‰passï¼Œåˆ™ä¸ºpass

### 2. å·¥å…·ç³»ç»Ÿ

#### å·¥å…·ç±»å‹
- **å¯æ‰§è¡Œå·¥å…·**: 300ä¸ªPythonå‡½æ•°ï¼Œæ¶µç›–æ–‡ä»¶æ“ä½œã€æ•°æ®åº“ã€ç»Ÿè®¡åˆ†æã€å¯è§†åŒ–ã€æ“ä½œç³»ç»Ÿã€å›¾åƒå¤„ç†ã€å¤–éƒ¨APIç­‰
- **RapidAPIå·¥å…·**: 3400ä¸ªAPIå·¥å…·ï¼Œæ”¯æŒè™šæ‹Ÿå›å¤æœºåˆ¶
- **æ–‡ä»¶ç³»ç»Ÿå·¥å…·**: æ–‡ä»¶æ“ä½œã€ç›®å½•éå†ã€å†…å®¹è¯»å–ç­‰
- **æ•°æ®åº“å·¥å…·**: è¡¨ç»“æ„æŸ¥è¯¢ã€æ•°æ®æ£€ç´¢ã€SQLæ‰§è¡Œç­‰
- **å›¾åƒå¤„ç†å·¥å…·**: å›¾åƒåˆ†æã€å¤„ç†ã€ç”Ÿæˆç­‰
- **Pythonå·¥å…·**: ä»£ç æ‰§è¡Œã€æ•°æ®åˆ†æç­‰

#### å·¥å…·è°ƒç”¨æ¨¡å¼
- **Single**: å•å·¥å…·è°ƒç”¨
- **Parallel**: å¹¶è¡Œå·¥å…·è°ƒç”¨
- **Multiple**: å¤šå·¥å…·è°ƒç”¨
- **Dependent**: ä¾èµ–å·¥å…·è°ƒç”¨
- **No-tool-use**: ä¸ä½¿ç”¨å·¥å…·
- **Miss-param**: å‚æ•°ç¼ºå¤±æƒ…å†µ

### 3. æ–‡ä»¶ç³»ç»Ÿ

Agentä¸ç¯å¢ƒäº’åŠ¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œ**å®Œå…¨æ”¯æŒè‡ªå®šä¹‰é…ç½®**ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„æ•°æ®ç”Ÿæˆéœ€æ±‚è¿›è¡Œä¸ªæ€§åŒ–é…ç½®ã€‚

#### æ–‡ä»¶ç³»ç»Ÿç‰¹æ€§
- **å¤šæ ·çš„æ–‡ä»¶ç±»å‹**: ç›®å‰ç»™å‡ºäº†80+ä¸ªä¸åŒæ ¼å¼çš„æ–‡ä»¶ä½œä¸ºagentä¸ç¯å¢ƒäº’åŠ¨çš„åŸºç¡€ï¼ˆtxtã€excelã€csvã€pdfã€jpgã€jsonã€dbæ•°æ®åº“ç­‰ï¼‰
- **çµæ´»çš„æ–‡ä»¶ç»“æ„**: å¯ä»¥åˆ›å»ºä»»æ„æ·±åº¦çš„ç›®å½•ç»“æ„ï¼Œæ¨¡æ‹ŸçœŸå®çš„æ–‡ä»¶ç³»ç»Ÿç¯å¢ƒ
- **åŠ¨æ€æ–‡ä»¶é‡‡æ ·**: æ”¯æŒéšæœºé‡‡æ ·æŒ‡å®šæ•°é‡çš„æ–‡ä»¶ï¼Œå¢åŠ æ•°æ®ç”Ÿæˆçš„å¤šæ ·æ€§
- **ä¸´æ—¶å·¥ä½œç›®å½•**: æ¯æ¬¡æ•°æ®ç”Ÿæˆéƒ½ä¼šåˆ›å»ºç‹¬ç«‹çš„ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿå‰¯æœ¬ï¼Œç¡®ä¿æ•°æ®éš”ç¦»


### 4. æ•°æ®ç”Ÿæˆæµç¨‹

```
1. åˆå§‹åŒ–Pipeline
   â”œâ”€â”€ å·¥å…·é‡‡æ ·å’Œé…ç½®ï¼ˆæ”¯æŒåŠ¨æ€æƒé‡è°ƒæ•´ï¼‰
   â”œâ”€â”€ æ–‡ä»¶ç³»ç»Ÿå‡†å¤‡ï¼ˆ80+ç§æ ¼å¼æ–‡ä»¶ï¼‰
   â””â”€â”€ æ™ºèƒ½ä½“åˆå§‹åŒ–ï¼ˆæ²™ç›’ç¯å¢ƒï¼‰

2. é—®é¢˜ç”Ÿæˆé˜¶æ®µ
   â”œâ”€â”€ UserAgentåŸºäºæ–‡ä»¶ä¿¡æ¯ã€å·¥å…·ã€è°ƒç”¨æ¨¡å¼ã€è¯­æ°”é£æ ¼ç”Ÿæˆé—®é¢˜
   â”œâ”€â”€ æ”¯æŒå¤šç§ä»»åŠ¡æ¨¡å¼ï¼ˆsingleã€parallelã€multipleã€dependentç­‰ï¼‰
   â””â”€â”€ ä»persona_hubé‡‡æ ·äººæ ¼ç±»å‹

3. é—®é¢˜è§£å†³é˜¶æ®µ
   â”œâ”€â”€ AssistantAgentåˆ†æé—®é¢˜ï¼ˆæ— æ³•çœ‹åˆ°ç¯å¢ƒå’Œæ–‡ä»¶å†…å®¹ï¼‰
   â”œâ”€â”€ é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼ˆéœ€è¦è°ƒç”¨å·¥å…·è®¿é—®ç¯å¢ƒï¼‰
   â”œâ”€â”€ ToolAgentåœ¨æ²™ç›’ç¯å¢ƒä¸­æ‰§è¡Œå·¥å…·
   â””â”€â”€ å¾ªç¯ç›´åˆ°ä»»åŠ¡å®Œæˆæˆ–è¾¾åˆ°æœ€å¤§è½®æ•°

4. è´¨é‡æ£€æŸ¥é˜¶æ®µ
   â”œâ”€â”€ CheckerAgentå¤šå±‚æ¬¡æ£€æŸ¥ï¼ˆrule checkerã€llm checkerã€tool call checkerï¼‰
   â”œâ”€â”€ é”™è¯¯ä¿®æ­£å’Œé‡è¯•ï¼ˆæœ€å¤šnæ¬¡ï¼‰
   â””â”€â”€ ç¡®ä¿æ•°æ®è´¨é‡

5. æ•°æ®åå¤„ç†
   â”œâ”€â”€ ç­›é€‰å­˜åœ¨å¹»è§‰ã€è¿‡é•¿ã€ä»»åŠ¡æ— æ³•å®Œæˆçš„æ•°æ®
   â”œâ”€â”€ æ ¼å¼è½¬æ¢ï¼ˆæ”¯æŒyamlã€toolaceã€xmlã€qwenã€openaiç­‰æ ¼å¼ï¼‰
   â””â”€â”€ æ¸…ç†ä¸´æ—¶èµ„æºå’Œæ²™ç›’ç¯å¢ƒ
```

### 5. å®éªŒä¸ç»“æœ

åŸºäºå½“å‰å·¥å…·ç³»ç»Ÿå’Œæ–‡ä»¶ç³»ç»Ÿï¼Œæˆ‘ä»¬ç”Ÿæˆäº†8kæ¡å¤šè½®å·¥å…·è°ƒç”¨æ•°æ®ï¼Œå¹¶åŸºäºqwen-32bæ¨¡å‹è¿›è¡ŒLoRAå¾®è°ƒï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šåˆ©ç”¨ToolRLæ¡†æ¶è¿›è¡Œäº†RLè®­ç»ƒï¼Œå½“å‰BFCLæ¦œå•ä¸Šæ’åç¬¬5ï¼Œå·²è¾¾åˆ°Deepseek-R1çš„æ•ˆæœã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„å®éªŒç»“æœï¼š

#### å®éªŒé…ç½®
- **æ•°æ®è§„æ¨¡**: 8kæ¡å¤šè½®å·¥å…·è°ƒç”¨æ•°æ®
- **åŸºç¡€æ¨¡å‹**: qwen2.5-32b-instruct
- **å¾®è°ƒæ–¹æ³•**: LoRA (Low-Rank Adaptation)
- **è¯„ä¼°åŸºå‡†**: BFCL (Berkeley Function Call Leaderboard)

#### å®éªŒç»“æœå¯¹æ¯”

| å®éªŒåç§° | æ•°æ®é‡ | BFCL Overall | Multi-turn All | Multi-turn Base | Miss Func | Miss Param | Long Context |
|----------|--------|--------------|----------------|-----------------|-----------|------------|--------------|
| **ToolRL (pretrain model 37.38) step 300** | 61,308 (å•è½®) 16k | **71.47%** | **45.875%** | **58.50%** | **35.50%** | **37.00%** | **52.50%** |
| **ToolRL (pretrain model 37.38) step 300** | 43,530 (å•è½®) 8k | 70.57% | 44.00% | 56.50% | 34.00% | 36.50% | 49.00% |
| **qwen2.5-32b-0616-v12500yaml-v2gpt2500toolace-v3gpt2500qwen-qwq500missfunc-epoch5** | 8,000 | 66.19% | 37.38% | 48.50% | 29.50% | 30.00% | 41.50% |
| **qwen2.5-32b-0614-v12500yaml-v2gpt2500toolace-v3gpt2500qwen-epoch5** | 7,500 | 66.74% | 36.75% | 50.5% | 27.5% | 29% | 40% |
| **qwen2.5-32b-0613-v12500yaml-v2gpt1500qwen-v3gpt1000toolace-epoch5** | 6,000 | 65.70% | 34.62% | 42.50% | 28.00% | 30.50% | 37.50% |
| **qwen2d5_32B_instruct (åŸå§‹æ¨¡å‹)** | - | 62.79% | 22.25% | 29.5% | 25.5% | 20.5% | 13.5% |
| **xLAM-2-32b-fc-r (FC)** | - | 76.43% | 67.12% | 79% | 71.5% | 63.5% | 54.5% |
| **GPT-4o-2024-11-20 (FC)** | - | 71.71% | 50% | 61% | 45.5% | 35.5% | 58% |

#### å…³é”®å‘ç°

1. **å¾®è°ƒæ•ˆæœæ˜¾è‘—**: ç›¸æ¯”åŸå§‹qwen2.5-32bæ¨¡å‹ï¼ŒLoRAå¾®è°ƒååœ¨å„é¡¹æŒ‡æ ‡ä¸Šéƒ½æœ‰æ˜¾è‘—æå‡
2. **æ•°æ®è´¨é‡å½±å“**: æ•°æ®é‡ä»6kå¢åŠ åˆ°8kï¼Œæ¨¡å‹æ€§èƒ½æœ‰ç¨³å®šæå‡
3. **æ ¼å¼æ··åˆè®­ç»ƒ**: é‡‡ç”¨å¤šç§æ ¼å¼æ··åˆè®­ç»ƒç­–ç•¥ï¼Œæå‡äº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›
4. **ä¸SOTAå¯¹æ¯”**: åœ¨éƒ¨åˆ†ä»»åŠ¡ä¸Šæ¥è¿‘æˆ–è¾¾åˆ°å½“å‰æœ€ä¼˜æ°´å¹³

#### è¯„ä¼°æŒ‡æ ‡è¯´æ˜

- **BFCL Overall**: ç»¼åˆåŠŸèƒ½è°ƒç”¨èƒ½åŠ›è¯„åˆ†
- **Multi-turn All**: å¤šè½®å¯¹è¯æ•´ä½“è¡¨ç°
- **Multi-turn Base**: åŸºç¡€å¤šè½®å¯¹è¯èƒ½åŠ›
- **Miss Func**: å‡½æ•°ç¼ºå¤±æƒ…å†µå¤„ç†èƒ½åŠ›
- **Miss Param**: å‚æ•°ç¼ºå¤±æƒ…å†µå¤„ç†èƒ½åŠ›
- **Long Context**: é•¿ä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›         



## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

```bash
# Python 3.8+
cd data_generate
pip install -e .
```

### ç¯å¢ƒå‡†å¤‡

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export PROJECT_DIR=$(pwd)
export HOME_DIR=$HOME

# å‡†å¤‡æ–‡ä»¶ç³»ç»Ÿç¯å¢ƒï¼ˆ80+ç§æ ¼å¼æ–‡ä»¶ï¼‰
mkdir -p working_dir/file_system
# æ·»åŠ txtã€excelã€csvã€pdfã€jpgã€jsonç­‰æ ¼å¼æ–‡ä»¶

# é…ç½®.envæ–‡ä»¶
cp .env.example .env
# ç¼–è¾‘.envæ–‡ä»¶ï¼Œé…ç½®APIå¯†é’¥ç­‰
```

### åŸºæœ¬ä½¿ç”¨

```python
from data_generate.pipeline import Pipeline

# åˆ›å»ºPipelineå®ä¾‹
pipeline = Pipeline(
    tool_defines_path=['./tools/defines/'],
    save_path='./output/data.jsonl',
    failed_save_path='./output/failed.jsonl',
    max_task_turns=3,
    assistant_model_name='gpt4o-ptu-client',
    # å·¥å…·é…ç½®
    tool_nums_distribution={1: 200, 2: 140, 3: 120, 4: 100, 5: 90},
    # è°ƒç”¨æ¨¡å¼æƒé‡
    mode_weights={"single": 1, "parallel": 1, "multiple": 1, "dependent": 1, "no_tool_use": 1, "miss_param": 1},
    # ä»»åŠ¡è½®æ•°æƒé‡
    task_turn_weights={1: 0.5, 2: 0.3, 3: 0.2}
)

# ç”Ÿæˆæ•°æ®
data = {'data_id': 'test_001'}
success = pipeline._generate(data, save=True)
```

### å‘½ä»¤è¡Œä½¿ç”¨

```bash
# åŸºæœ¬æ•°æ®ç”Ÿæˆ
python pipeline.py --target_generate_data_number 100

# æŒ‡å®šå·¥å…·å’Œæ¨¡å‹
python pipeline.py \
    --tool_defines_path "['./tools/defines/file_system_functions']" \
    --assistant_model_name "gpt4o-ptu-client" \
    --target_generate_data_number 50

# å¤šçº¿ç¨‹ç”Ÿæˆ
python pipeline.py \
    --num_workers 4 \
    --target_generate_data_number 200
```

## âš™ï¸ é…ç½®é€‰é¡¹

### æ ¸å¿ƒå‚æ•°

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `tool_defines_path` | å·¥å…·å®šä¹‰è·¯å¾„åˆ—è¡¨ | `['./tools/defines/']` |
| `save_path` | æˆåŠŸæ•°æ®ä¿å­˜è·¯å¾„ | `./generated_data/data.jsonl` |
| `failed_save_path` | å¤±è´¥æ•°æ®ä¿å­˜è·¯å¾„ | `./generated_data/failed.jsonl` |
| `max_task_turns` | æœ€å¤§ä»»åŠ¡è½®æ•° | `3` |
| `checker_max_retries` | æ£€æŸ¥å™¨æœ€å¤§é‡è¯•æ¬¡æ•° | `1` |
| `assistant_n_response` | åŠ©æ‰‹å“åº”æ•°é‡ï¼ˆä¼—æŠ•ï¼‰ | `1` |
| `tool_nums_distribution` | å·¥å…·æ•°é‡åˆ†å¸ƒæƒé‡ | `{1: 200, 2: 140, 3: 120, 4: 100, 5: 90}` |
| `mode_weights` | å·¥å…·è°ƒç”¨æ¨¡å¼æƒé‡ | `{"single": 1, "parallel": 1, "multiple": 1, "dependent": 1, "no_tool_use": 1, "miss_param": 1}` |
| `task_turn_weights` | ä»»åŠ¡è½®æ•°æƒé‡ | `{1: 0.5, 2: 0.3, 3: 0.2}` |
| `files_num` | æ–‡ä»¶æ•°é‡åˆ†å¸ƒ | `{1: 0, 2: 0.2, 3: 0.3, 4: 0.3, 5: 0.2}` |

### æ¨¡å‹é…ç½®

| å‚æ•° | è¯´æ˜ | æ”¯æŒå€¼ |
|------|------|--------|
| `assistant_model_name` | åŠ©æ‰‹æ¨¡å‹åç§° | `gpt4o-ptu-client`, `qwq`, `qwen`, `deepseek` |
| `user_model_name` | ç”¨æˆ·æ¨¡å‹åç§° | åŒä¸Š |
| `tool_model_name` | å·¥å…·æ¨¡å‹åç§° | åŒä¸Š |
| `checker_model_name` | æ£€æŸ¥å™¨æ¨¡å‹åç§° | åŒä¸Š |

### å·¥å…·é…ç½®

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `fixed_tools` | å›ºå®šå·¥å…·åˆ—è¡¨ | `[]` |
| `tool_nums_distribution` | å·¥å…·æ•°é‡åˆ†å¸ƒæƒé‡ | `{1: 200, 2: 140, 3: 120, 4: 100, 5: 90}` |
| `category_fixed_tools` | åˆ†ç±»å›ºå®šå·¥å…· | `{'file_system_functions': ['display_directory_tree', 'get_file_info'], 'database_functions': ['get_database_info']}` |
| `tool_output_limit` | å·¥å…·è¾“å‡ºé™åˆ¶ | `4096` |
| `dynamic_adjust_mode_and_task_turn_weight` | åŠ¨æ€è°ƒæ•´æƒé‡ | `False` |

### æ–‡ä»¶ç³»ç»Ÿé…ç½®

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `file_system_path` | æ–‡ä»¶ç³»ç»Ÿæ ¹è·¯å¾„ | `./working_dir/file_system/` |
| `files_num` | æ–‡ä»¶æ•°é‡åˆ†å¸ƒ | `{1: 0, 2: 0.2, 3: 0.3, ...}` |
| `provide_file_system_info` | æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯æä¾›æ–¹å¼ | `'none'` |


## ğŸ“Š æ•°æ®æ ¼å¼

### ç”Ÿæˆçš„æ•°æ®ç»“æ„

```json
{
    "data_id": "unique_id",
    "messages": [
        {"role": "system", "content": "ç³»ç»Ÿæç¤ºè¯"},
        {"role": "user", "content": "ç”¨æˆ·é—®é¢˜"},
        {"role": "assistant", "content": "åŠ©æ‰‹å“åº”", "tool_calls": [...]},
        {"role": "tool", "content": "å·¥å…·æ‰§è¡Œç»“æœ"},
        {"role": "user", "content": "ä»»åŠ¡æ¾„æ¸…æˆ–å®Œæˆç¡®è®¤"}
    ],
    "tools": ["ä½¿ç”¨çš„å·¥å…·åˆ—è¡¨"],
    "assistant_reasonings": {"æ¨ç†è¿‡ç¨‹"},
    "selected_files": ["æ¶‰åŠçš„æ–‡ä»¶"],
    "checker_not_pass_index": [æ£€æŸ¥æœªé€šè¿‡çš„ç´¢å¼•],
    "task_complete_index": [ä»»åŠ¡å®Œæˆç´¢å¼•],
    "is_task_completable": [ä»»åŠ¡å¯å®Œæˆæ€§],
    "dialog_mode": ["å¯¹è¯æ¨¡å¼"],
    "round_cnt": ä»»åŠ¡è½®æ•°
}
```


## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# å…‹éš†é¡¹ç›®
git clone [<repository_url>](https://gitlab.bj.sensetime.com/lm-toolchain/function_call_data.git)
cd function_call_data

# å®‰è£…ä¾èµ–
pip install -e .

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- é‚®ä»¶è”ç³»: qinxinyi@sensetime.com
- é¡¹ç›®ä¸»é¡µ: [GitLab Repository](https://gitlab.bj.sensetime.com/lm-toolchain/function_call_data/-/tree/qinxinyi/data_generate?ref_type=heads)

---
